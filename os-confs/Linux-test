; 1st SECTION

N Linux 2.6.24 under test
M SniffJoke team - mailing list sniffjoke@sikurezza.org
; what's follow are the command that shall be checked by "which"
C ifconfig
C route
C arp
;C arping
C iptables
C awk
C line

; 2nd SECTION

; SPECIAL: ~Z mean: the fake gateway ip address
; SPECIAL: ~K mean: the fake mtu value
;         these value are specify by the users or hardcoded, therefore are treated differently

;1 get the default gateway ip address
I1 #route -n | grep UG | grep "^0.0" | awk {'print $2'}#

;2 get the network interface used to reach the default gateway ($1)
I2 #route -n | grep UG | grep "^0.0" | awk {'print $8'}#

;3 get the ip address of $2 (the network interface at the point 2)
I3 #ifconfig ~2 | grep "inet addr" | line | cut -b 21- | awk {'print $1'}#

;4 get the MTU of $2
I4 #ifconfig ~2 | grep MTU | line | sed -es/.*MTU:// | awk {'print $1'}#

;5 get the mac address of $2
I5 #arp -n | grep "~1 " | awk {' print $3 '}#

;6 get the mac address of $1
I6 #ifconfig eth0 | grep HWaddr | line | awk {' print $5'}#

; 3rd SECTION

;7 add a default gateway
S7 #route add default gw ~Z dev ~T#

;8 delete the janus default gateway
S8 #route del default gw ~Z dev ~T#

;9 add a firewall rules able to drop incoming traffic with src mac addr $5
S9 #iptables -A FORWARD -i ~2 -m mac --mac-source ~6 -j DROP && iptables -A INPUT -i ~2 -m mac --mac-source ~6 -j DROP#

;A delete the firewall rules insert with $9
SA #iptables -D FORWARD -i ~2 -m mac --mac-source ~6 -j DROP && iptables -D INPUT -i ~2 -m mac --mac-source ~6 -j DROP#

;B setup the $6
SB #ifconfig ~T ~3 pointopoint ~Z mtu ~K#

;C add a firewall rule able to NAT the traffic thru the tunnel $B
SC #iptables -A POSTROUTING -o ~T -t nat -j MASQUERADE#

;D delete the firewall rule insert with $C
SD #iptables -D POSTROUTING -o ~T -t nat -j MASQUERADE#

;E delete the system default gateway
SE #route del default#

;G restore the system default gateway
SG #route add default gw ~1#
